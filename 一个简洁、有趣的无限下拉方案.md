# ä¸€ä¸ªç®€æ´ã€æœ‰è¶£çš„æ— é™ä¸‹æ‹‰æ–¹æ¡ˆ

## æœ¬æ–‡ä¸»æ—¨

é•¿åˆ—è¡¨æ¸²æŸ“ã€æ— é™ä¸‹æ‹‰ä¹Ÿç®—æ˜¯å‰ç«¯å¼€å‘è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ä¹‹ä¸€äº†ï¼Œæœ¬æ–‡å°†ä»‹ç»ä¸€ç§**ç®€æ´ã€å·§å¦™ã€é«˜æ•ˆ**çš„æ–¹å¼æ¥å®ç°ã€‚è¯ä¸å¤šè¯´ï¼Œçœ‹ä¸‹å›¾ï¼Œä¹Ÿè®¸ä½ å¯ä»¥å‘ç°ä»€ä¹ˆï¼Ÿ

![æ— é™ä¸‹æ‹‰ç¤ºæ„å›¾](https://user-gold-cdn.xitu.io/2019/12/3/16ec962605986af6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

ä¸çŸ¥ä½ æ˜¯å¦ä»ä¸Šé¢è¿™å¼ å›¾ä¸­æ³¨æ„åˆ°äº†ä»€ä¹ˆï¼Œæ¯”å¦‚åªæ˜¯æ¸²æŸ“äº†å¯è§†åŒºåŸŸçš„éƒ¨åˆ† DOM ï¼Œæ»šåŠ¨è¿‡ç¨‹ä¸­åªæ˜¯å¤–å±‚å®¹å™¨çš„ padding åœ¨æ”¹å˜ï¼Ÿ

å‰ä¸€ç‚¹å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬è€ƒè™‘åˆ°æ€§èƒ½ï¼Œä¸å¯èƒ½å°†ä¸€ä¸ªé•¿åˆ—è¡¨ï¼ˆç”šè‡³æ˜¯ä¸€ä¸ªæ— é™ä¸‹æ‹‰åˆ—è¡¨ï¼‰çš„æ‰€æœ‰åˆ—è¡¨å…ƒç´ éƒ½è¿›è¡Œæ¸²æŸ“ï¼›è€Œåä¸€ç‚¹ï¼Œåˆ™æ˜¯æœ¬æ–‡æ‰€ä»‹ç»æ–¹æ¡ˆçš„æ ¸å¿ƒä¹‹ä¸€ï¼

ä¸å–å…³å­ï¼Œæå‰å‘Šè¯‰ä½ è¯¥æ–¹æ¡ˆçš„è¦ç´ å°±æ˜¯ä¸¤ä¸ªï¼š

- **Intersection Observer**
- **padding**

è¯´æ˜äº†è¦ç´ ï¼Œä¹Ÿè®¸ä½ å¯ä»¥å°è¯•ç€å¼€å§‹æ€è€ƒï¼Œçœ‹ä½ æ˜¯å¦èƒ½çŒœåˆ°å…·ä½“çš„å®ç°æ–¹æ¡ˆã€‚

## æ–¹æ¡ˆä»‹ç»

### Intersection Observer

#### åŸºæœ¬æ¦‚å¿µ

ä¸€ç›´ä»¥æ¥ï¼Œ**æ£€æµ‹å…ƒç´ çš„å¯è§†çŠ¶æ€æˆ–è€…ä¸¤ä¸ªå…ƒç´ çš„ç›¸å¯¹å¯è§†çŠ¶æ€**éƒ½ä¸æ˜¯ä»¶å®¹æ˜“äº‹ã€‚ä¼ ç»Ÿçš„å„ç§æ–¹æ¡ˆä¸ä½†å¤æ‚ï¼Œè€Œä¸”æ€§èƒ½æˆæœ¬å¾ˆé«˜ï¼Œæ¯”å¦‚éœ€è¦ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œç„¶åæŸ¥è¯¢ DOM , è·å–å…ƒç´ é«˜åº¦ã€ä½ç½®ï¼Œè®¡ç®—è·ç¦»è§†çª—é«˜åº¦ç­‰ç­‰ã€‚

è¿™å°±æ˜¯ Intersection Observer è¦è§£å†³çš„é—®é¢˜ã€‚å®ƒä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ç§ä¾¿æ·çš„æ–°æ–¹æ³•æ¥**å¼‚æ­¥æŸ¥è¯¢**å…ƒç´ ç›¸å¯¹äºå…¶ä»–å…ƒç´ æˆ–è§†çª—çš„ä½ç½®ï¼Œæ¶ˆé™¤äº†æ˜‚è´µçš„ DOM æŸ¥è¯¢å’Œæ ·å¼è¯»å–æˆæœ¬ã€‚

#### å…¼å®¹æ€§

ä¸»è¦åœ¨ Safari ä¸Šå…¼å®¹æ€§è¾ƒå·®ï¼Œéœ€è¦ 12.2 åŠä»¥ä¸Šæ‰å…¼å®¹ï¼Œä¸è¿‡è¿˜å¥½ï¼Œæœ‰ [polyfill](https://www.npmjs.com/package/intersection-observer) å¯é£Ÿç”¨ã€‚

#### ä¸€äº›åº”ç”¨åœºæ™¯

- é¡µé¢æ»šåŠ¨æ—¶çš„æ‡’åŠ è½½å®ç°ã€‚
- æ— é™ä¸‹æ‹‰ï¼ˆæœ¬æ–‡çš„å®ç°ï¼‰ã€‚
- ç›‘æµ‹æŸäº›å¹¿å‘Šå…ƒç´ çš„æ›å…‰æƒ…å†µæ¥åšç›¸å…³æ•°æ®ç»Ÿè®¡ã€‚
- ç›‘æµ‹ç”¨æˆ·çš„æ»šåŠ¨è¡Œä¸ºæ˜¯å¦åˆ°è¾¾äº†ç›®æ ‡ä½ç½®æ¥å®ç°ä¸€äº›äº¤äº’é€»è¾‘ï¼ˆæ¯”å¦‚è§†é¢‘å…ƒç´ æ»šåŠ¨åˆ°éšè—ä½ç½®æ—¶æš‚åœæ’­æ”¾ï¼‰ã€‚

### padding æ–¹æ¡ˆå®ç°

åŸºæœ¬äº†è§£ Intersection Observer ä¹‹åï¼Œæ¥ä¸‹æ¥å°±çœ‹ä¸‹å¦‚ä½•ç”¨ Intersection Observer + padding æ¥å®ç°æ— é™ä¸‹æ‹‰ã€‚

å…ˆæ¦‚è§ˆä¸‹æ€»ä½“æ€è·¯ï¼š

- ç›‘å¬ä¸€ä¸ªå›ºå®šé•¿åº¦åˆ—è¡¨çš„é¦–å°¾å…ƒç´ æ˜¯å¦è¿›å…¥è§†çª—ï¼›
- æ›´æ–°å½“å‰é¡µé¢å†…æ¸²æŸ“çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¯¹åº”çš„åºå·ï¼›
- æ ¹æ®ä¸Šè¿°åºå·ï¼Œè·å–ç›®æ ‡æ•°æ®å…ƒç´ ï¼Œåˆ—è¡¨å†…å®¹é‡æ–°æ¸²æŸ“æˆå¯¹åº”å†…å®¹ï¼›
- å®¹å™¨ padding è°ƒæ•´ï¼Œæ¨¡æ‹Ÿæ»šåŠ¨å®ç°ã€‚

**æ ¸å¿ƒï¼šåˆ©ç”¨çˆ¶å…ƒç´ çš„ padding å»å¡«å……éšç€æ— é™ä¸‹æ‹‰è€Œæœ¬è¯¥æœ‰çš„ã€è¶Šæ¥è¶Šå¤šçš„ DOM å…ƒç´ ï¼Œä»…ä»…ä¿ç•™è§†çª—åŒºåŸŸä¸Šä¸‹ä¸€å®šæ•°é‡çš„ DOM å…ƒç´ æ¥è¿›è¡Œæ•°æ®æ¸²æŸ“**ã€‚

#### 1ã€ç›‘å¬ä¸€ä¸ªå›ºå®šé•¿åº¦åˆ—è¡¨çš„é¦–å°¾å…ƒç´ æ˜¯å¦è¿›å…¥è§†çª—

```
// è§‚å¯Ÿè€…åˆ›å»º
this.observer = new IntersectionObserver(callback, options);

// è§‚å¯Ÿåˆ—è¡¨ç¬¬ä¸€ä¸ªä»¥åŠæœ€åä¸€ä¸ªå…ƒç´ 
this.observer.observe(this.firstItem);
this.observer.observe(this.lastItem);
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬ä»¥åœ¨é¡µé¢ä¸­æ¸²æŸ“å›ºå®šçš„ 20 ä¸ªåˆ—è¡¨å…ƒç´ ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼Œç”¨ Intersection Observer è¿›è¡Œè§‚å¯Ÿï¼Œå½“ä»–ä»¬å…¶ä¸­ä¸€ä¸ªé‡æ–°è¿›å…¥è§†çª—æ—¶ï¼Œcallback å‡½æ•°å°±ä¼šè§¦å‘ï¼š

```
const callback = (entries) => {
    entries.forEach((entry) => {
        if (entry.target.id === firstItemId) {
            // å½“ç¬¬ä¸€ä¸ªå…ƒç´ è¿›å…¥è§†çª—
        } else if (entry.target.id === lastItemId) {
            // å½“æœ€åä¸€ä¸ªå…ƒç´ è¿›å…¥è§†çª—
        }
    });
};
å¤åˆ¶ä»£ç 
```

#### 2ã€æ›´æ–°å½“å‰é¡µé¢æ¸²æŸ“çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¯¹åº”çš„åºå· (firstIndex)

æ‹¿å…·ä½“ä¾‹å­æ¥è¯´æ˜ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ•°ç»„æ¥ç»´æŠ¤éœ€è¦æ¸²æŸ“åˆ°é¡µé¢ä¸­çš„æ•°æ®ã€‚æ•°ç»„çš„é•¿åº¦ä¼šéšç€ä¸æ–­è¯·æ±‚æ–°çš„æ•°æ®è€Œä¸æ–­å˜å¤§ï¼Œè€Œæ¸²æŸ“çš„å§‹ç»ˆæ˜¯å…¶ä¸­ä¸€å®šæ•°é‡çš„å…ƒç´ ï¼Œæ¯”å¦‚ 20 ä¸ªã€‚ é‚£ä¹ˆï¼š

- 1ã€æœ€å¼€å§‹æ¸²æŸ“çš„æ˜¯æ•°ç»„ä¸­åºå·ä¸º 0 - 19 çš„å…ƒç´ ï¼Œå³æ­¤æ—¶å¯¹åº”çš„ firstIndex ä¸º 0ï¼›
- 2ã€å½“åºå·ä¸º 19 çš„å…ƒç´ ï¼ˆå³ä¸Šä¸€æ­¥çš„ lastItem ï¼‰è¿›å…¥è§†çª—æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šå¾€åæ¸²æŸ“ 10 ä¸ªå…ƒç´ ï¼Œå³æ¸²æŸ“åºå·ä¸º 10 - 29 çš„å…ƒç´ ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„ firstIndex ä¸º 10ï¼›
- 3ã€ä¸‹ä¸€æ¬¡å°±æ˜¯ï¼Œå½“åºå·ä¸º 29 çš„å…ƒç´ è¿›å…¥è§†çª—æ—¶ï¼Œç»§ç»­å¾€åæ¸²æŸ“ 10ä¸ªå…ƒç´ ï¼Œå³æ¸²æŸ“åºå·ä¸º 20 - 39 çš„å…ƒç´ ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„ firstIndex ä¸º 20ï¼Œä»¥æ­¤ç±»æ¨ã€‚ã€‚ã€‚

```
// æˆ‘ä»¬å¯¹åŸå…ˆçš„ firstIndex åšäº†ç¼“å­˜
const { currentIndex } = this.domDataCache;

// ä»¥å…¨éƒ¨å®¹å™¨å†…æ‰€æœ‰å…ƒç´ çš„ä¸€åŠä½œä¸ºæ¯ä¸€æ¬¡æ¸²æŸ“çš„å¢é‡
const increment = Math.floor(this.listSize / 2);

let firstIndex;

if (isScrollDown) {
    // å‘ä¸‹æ»šåŠ¨æ—¶åºå·å¢åŠ 
    firstIndex = currentIndex + increment;
} else {
    // å‘ä¸Šæ»šåŠ¨æ—¶åºå·å‡å°‘
    firstIndex = currentIndex - increment;
}
å¤åˆ¶ä»£ç 
```

**æ€»ä½“æ¥è¯´ï¼Œæ›´æ–° firstIndexï¼Œæ˜¯ä¸ºäº†æ ¹æ®é¡µé¢çš„æ»šåŠ¨æƒ…å†µï¼ŒçŸ¥é“æ¥ä¸‹æ¥å“ªäº›æ•°æ®åº”è¯¥è¢«è·å–ã€æ¸²æŸ“ã€‚**

#### 3ã€æ ¹æ®ä¸Šè¿°åºå·ï¼Œè·å–å¯¹åº”æ•°æ®å…ƒç´ ï¼Œåˆ—è¡¨é‡æ–°æ¸²æŸ“æˆæ–°çš„å†…å®¹

```
const renderFunction = (firstIndex) => {
    // offset = firstIndex, limit = 10 => getData
    // getData Done =>  new dataItems => render DOM
 };
å¤åˆ¶ä»£ç 
```

è¿™ä¸€éƒ¨åˆ†å°±æ˜¯æ ¹æ® firstIndex æŸ¥è¯¢æ•°æ®ï¼Œç„¶åå°†ç›®æ ‡æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸Šå³å¯ã€‚

#### 4ã€padding è°ƒæ•´ï¼Œæ¨¡æ‹Ÿæ»šåŠ¨å®ç°

æ—¢ç„¶æ•°æ®çš„æ›´æ–°ä»¥åŠ DOM å…ƒç´ çš„æ›´æ–°æˆ‘ä»¬å·²ç»å®ç°äº†ï¼Œé‚£ä¹ˆæ— é™ä¸‹æ‹‰çš„æ•ˆæœä»¥åŠæ»šåŠ¨çš„ä½“éªŒï¼Œæˆ‘ä»¬è¦å¦‚ä½•å®ç°å‘¢ï¼Ÿ

æƒ³è±¡ä¸€ä¸‹ï¼ŒæŠ›å¼€ä¸€åˆ‡ï¼Œæœ€åŸå§‹æœ€ç›´æ¥æœ€ç²—æš´çš„æ–¹å¼æ— éå°±æ˜¯æˆ‘ä»¬å†åˆè·å–äº† 10 ä¸ªæ–°çš„æ•°æ®å…ƒç´ ä¹‹åï¼Œå†å¡ 10 ä¸ªæ–°çš„ DOM å…ƒç´ åˆ°é¡µé¢ä¸­å»æ¥æ¸²æŸ“è¿™äº›æ•°æ®ã€‚

ä½†æ­¤æ—¶ï¼Œå¯¹æ¯”ä¸Šé¢è¿™ä¸ªç²—æš´çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬çš„æ–¹æ¡ˆæ˜¯ï¼š**è¿™ 10ä¸ªæ–°çš„æ•°æ®å…ƒç´ ï¼Œæˆ‘ä»¬ç”¨åŸæ¥å·²æœ‰çš„ DOM å…ƒç´ å»æ¸²æŸ“ï¼Œæ›¿æ¢æ‰å·²ç»ç¦»å¼€è§†çª—ã€ä¸å¯è§çš„æ•°æ®å…ƒç´ ï¼›è€Œæœ¬è¯¥ç”±æ›´å¤š DOM å…ƒç´ è¿›ä¸€æ­¥æ’‘å¼€å®¹å™¨é«˜åº¦çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç”¨ padding å¡«å……æ¥æ¨¡æ‹Ÿå®ç°ã€‚**

![img](https://user-gold-cdn.xitu.io/2019/12/3/16ec961e91b62173?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

- å‘ä¸‹æ»šåŠ¨

```
// paddingçš„å¢é‡ = æ¯ä¸€ä¸ªitemçš„é«˜åº¦ x æ–°çš„æ•°æ®é¡¹çš„æ•°ç›®
const remPaddingsVal = itemHeight * (Math.floor(this.listSize / 2));

if (isScrollDown) {
    // paddingTopæ–°å¢ï¼Œå¡«å……é¡¶éƒ¨ä½ç½®
    newCurrentPaddingTop = currentPaddingTop + remPaddingsVal;

    if (currentPaddingBottom === 0) {
        newCurrentPaddingBottom = 0;
    } else {
        // å¦‚æœåŸæ¥æœ‰paddingBottomåˆ™å‡å»ï¼Œä¼šæœ‰æ»šåŠ¨åˆ°åº•éƒ¨çš„å…ƒç´ è¿›è¡Œæ›¿ä»£
        newCurrentPaddingBottom = currentPaddingBottom - remPaddingsVal;
    }
}
å¤åˆ¶ä»£ç 
```

![å‘ä¸‹æ»šåŠ¨ç¤ºæ„å›¾](https://user-gold-cdn.xitu.io/2019/12/3/16ec96260669ee9d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

- å‘ä¸Šæ»šåŠ¨

```
// paddingçš„å¢é‡ = æ¯ä¸€ä¸ªitemçš„é«˜åº¦ x æ–°çš„æ•°æ®é¡¹çš„æ•°ç›®
const remPaddingsVal = itemHeight * (Math.floor(this.listSize / 2));

if (!isScrollDown) {
    // paddingBottomæ–°å¢ï¼Œå¡«å……åº•éƒ¨ä½ç½®
    newCurrentPaddingBottom = currentPaddingBottom + remPaddingsVal;

    if (currentPaddingTop === 0) {
        newCurrentPaddingTop = 0;
    } else {
        // å¦‚æœåŸæ¥æœ‰paddingTopåˆ™å‡å»ï¼Œä¼šæœ‰æ»šåŠ¨åˆ°é¡¶éƒ¨çš„å…ƒç´ è¿›è¡Œæ›¿ä»£
        newCurrentPaddingTop = currentPaddingTop - remPaddingsVal;
    }
}
å¤åˆ¶ä»£ç 
```

![å‘ä¸Šæ»šåŠ¨ç¤ºæ„å›¾](https://user-gold-cdn.xitu.io/2019/12/3/16ec9626068c3b0f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

- æœ€åæ˜¯ padding è®¾ç½®æ›´æ–°ä»¥åŠç›¸å…³ç¼“å­˜æ•°æ®æ›´æ–°

```
// å®¹å™¨paddingé‡æ–°è®¾ç½®
this.updateContainerPadding({
    newCurrentPaddingBottom,
    newCurrentPaddingTop
})

// DOMå…ƒç´ ç›¸å…³æ•°æ®ç¼“å­˜æ›´æ–°
this.updateDomDataCache({
    currentPaddingTop: newCurrentPaddingTop,
    currentPaddingBottom: newCurrentPaddingBottom
});
å¤åˆ¶ä»£ç 
```

## æ€è€ƒæ€»ç»“

#### æ–¹æ¡ˆæ€»ç»“ï¼š

åˆ©ç”¨ Intersection Observer æ¥ç›‘æµ‹ç›¸å…³å…ƒç´ çš„æ»šåŠ¨ä½ç½®ï¼Œå¼‚æ­¥ç›‘å¬ï¼Œå°½å¯èƒ½å¾—å‡å°‘ DOM æ“ä½œï¼Œè§¦å‘å›è°ƒï¼Œç„¶åå»è·å–æ–°çš„æ•°æ®æ¥æ›´æ–°é¡µé¢å…ƒç´ ï¼Œå¹¶ä¸”ç”¨è°ƒæ•´å®¹å™¨ padding æ¥æ›¿ä»£äº†æœ¬è¯¥è¶Šæ¥è¶Šå¤šçš„ DOM å…ƒç´ ï¼Œæœ€ç»ˆå®ç°åˆ—è¡¨æ»šåŠ¨ã€æ— é™ä¸‹æ‹‰ã€‚

#### ç›¸å…³æ–¹æ¡ˆçš„å¯¹æ¯”

è¿™é‡Œå’Œè¾ƒä¸ºæœ‰åçš„åº“ - [iScroll](https://github.com/cubiq/iscroll) å®ç°çš„æ— é™ä¸‹æ‹‰æ–¹æ¡ˆè¿›è¡Œä¸€ä¸ªåŸºæœ¬çš„å¯¹æ¯”ï¼Œå¯¹æ¯”ä¹‹å‰å…ˆè¯´æ˜ä¸‹ iScroll infinite çš„å®ç°æ¦‚è¦ï¼š

- iScroll é€šè¿‡å¯¹ä¼ ç»Ÿæ»šåŠ¨äº‹ä»¶çš„ç›‘å¬ï¼Œè·å–æ»šåŠ¨è·ç¦»ï¼Œç„¶åï¼š
  1. è®¾ç½®çˆ¶å…ƒç´ çš„ translate æ¥å®ç°æ•´ä½“å†…å®¹çš„ä¸Šç§»ï¼ˆä¸‹ç§»ï¼‰ï¼›
  2. å†åŸºäºè¿™ä¸ªæ»šåŠ¨è·ç¦»è¿›è¡Œç›¸åº”è®¡ç®—ï¼Œå¾—çŸ¥ç›¸åº”å­å…ƒç´ å·²ç»è¢«æ»šåŠ¨åˆ°è§†çª—å¤–ï¼Œå¹¶ä¸”åˆ¤æ–­æ˜¯å¦åº”è¯¥å°†è¿™äº›ç¦»å¼€è§†çª—çš„å­å…ƒç´ ç§»åŠ¨åˆ°æœ«å°¾ï¼Œä»è€Œå†å¯¹å®ƒä»¬è¿›è¡Œ translate çš„è®¾ç½®æ¥ç§»åŠ¨åˆ°æœ«å°¾ã€‚è¿™å°±åƒæ˜¯ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ä¸€æ ·ï¼Œéšç€æ»šåŠ¨çš„è¿›è¡Œï¼Œé¡¶éƒ¨å…ƒç´ å…ˆå‡ºè§†çª—ï¼Œä½†åˆå°†ç§»åŠ¨åˆ°æœ«å°¾ï¼Œä»è€Œå®ç°æ— é™ä¸‹æ‹‰ã€‚
- ç›¸å…³å¯¹æ¯”ï¼š
  - å®ç°å¯¹æ¯”ï¼šä¸€ä¸ªæ˜¯ Intersection Observer çš„ç›‘å¬ï¼Œæ¥é€šçŸ¥å­å…ƒç´ ç¦»å¼€è§†çª—ï¼Œåªè¦å®šé‡è®¾ç½®çˆ¶å…ƒç´  padding å°±è¡Œï¼›å¦ä¸€ä¸ªæ˜¯å¯¹ä¼ ç»Ÿæ»šåŠ¨äº‹ä»¶çš„ç›‘å¬ï¼Œæ»šåŠ¨è·ç¦»çš„è·å–ï¼Œå†è¿›è¡Œä¸€ç³»åˆ—è®¡ç®—ï¼Œå»è®¾ç½®çˆ¶å…ƒç´ ä»¥åŠå­å…ƒç´ çš„ translateã€‚æ˜¾è€Œæ˜“è§ï¼Œå‰è€…çœ‹èµ·æ¥æ›´åŠ ç®€æ´æ˜äº†ä¸€äº›ã€‚
  - æ€§èƒ½å¯¹æ¯”ï¼šæˆ‘çŸ¥é“è¯´åˆ°å¯¹æ¯”ï¼Œä½ è„‘æµ·ä¸­è‚¯å®šä¸€ä¸‹å­ä¼šæƒ³åˆ°æ€§èƒ½é—®é¢˜ã€‚å…¶å®æ€§èƒ½å¯¹æ¯”çš„å…³é”®å°±æ˜¯ Intersection Observerã€‚å› ä¸ºå•å°± padding è®¾ç½®è¿˜æ˜¯ translate è®¾ç½®ï¼Œæ€§èƒ½æ–¹é¢çš„å·®è·æ˜¯ç”šå°çš„ï¼Œåªæ˜¯ä¸ªäººæ„Ÿè§‰ padding ä¼šç®€æ´äº›ï¼Ÿè€Œ Intersection Observer å…¶å®æŠ½ç¦»äº†æ‰€æœ‰æ»šåŠ¨å±‚é¢çš„ç›¸å…³é€»è¾‘ï¼Œä½ ä¸å†éœ€è¦å¯¹æ»šåŠ¨è·ç¦»ç­‰ç›¸åº” DOM å±æ€§è¿›è¡Œè·å–ï¼Œä¹Ÿä¸å†éœ€è¦è¿›è¡Œä¸€ç³»åˆ—æ»šåŠ¨è·ç¦»ç›¸å…³çš„å¤æ‚è®¡ç®—ï¼Œå¹¶ä¸”åŒæ­¥çš„æ»šåŠ¨äº‹ä»¶è§¦å‘å˜æˆå¼‚æ­¥çš„ï¼Œä½ ä¹Ÿä¸å†éœ€è¦å¦å¤–å»åšé˜²æŠ–ä¹‹ç±»çš„é€»è¾‘ï¼Œè¿™åœ¨æ€§èƒ½æ–¹é¢è¿˜æ˜¯æœ‰æ‰€æå‡çš„ã€‚

#### å­˜åœ¨çš„ç¼ºé™·ï¼š

- padding çš„è®¡ç®—ä¾èµ–åˆ—è¡¨é¡¹å›ºå®šçš„é«˜åº¦ã€‚
- è¿™æ˜¯ä¸€ä¸ªåŒæ­¥æ¸²æŸ“çš„æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ç›®å‰å®¹å™¨ padding çš„è®¡ç®—è°ƒæ•´ï¼Œæ— æ³•è®¡ç®—å¼‚æ­¥è·å–çš„æ•°æ®ï¼Œåªè·Ÿç”¨æˆ·çš„æ»šåŠ¨è¡Œä¸ºæœ‰å…³ã€‚è¿™çœ‹èµ·æ¥ä¸å®é™…ä¸šåŠ¡åœºæ™¯æœ‰äº›ä¸ç¬¦ã€‚è§£å†³æ€è·¯ï¼š
  - æ€è·¯ 1ã€åˆ©ç”¨ [Skeleton Screen Loading](https://uxdesign.cc/what-you-should-know-about-skeleton-screens-a820c45a571a) æ¥åŒæ­¥æ¸²æŸ“æ•°æ®å…ƒç´ ï¼Œä¸å—æ•°æ®å¼‚æ­¥è·å–çš„å½±å“ã€‚å³åœ¨æ•°æ®è¯·æ±‚è¿˜æœªå®Œæˆæ—¶ï¼Œå…ˆä½¿ç”¨ä¸€äº›å›¾ç‰‡è¿›è¡Œå ä½ï¼Œå¾…å†…å®¹åŠ è½½å®Œæˆä¹‹åå†è¿›è¡Œæ›¿æ¢ã€‚
  - æ€è·¯ 2ã€æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®ï¼Œé˜»å¡å®¹å™¨ padding çš„è®¾ç½®ï¼ˆå³æ— é™ä¸‹æ‹‰çš„å‘ç”Ÿï¼‰ç›´è‡³æ•°æ®è¯·æ±‚å®Œæ¯•ï¼Œç”¨ loading gif æç¤ºç”¨æˆ·åŠ è½½çŠ¶æ€ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆç›¸å¯¹å¤æ‚ï¼Œä½ éœ€è¦å…¨é¢è€ƒè™‘ç”¨æˆ·éš¾ä»¥é¢„æµ‹çš„æ»šåŠ¨è¡Œä¸ºæ¥è®¾ç½®å®¹å™¨çš„ paddingã€‚

#### å»¶ä¼¸æ‹“å±•

- è¯·å¤§å®¶æ€è€ƒä¸€ä¸‹ï¼Œæ— é™ä¸‹æ‹‰æœ‰äº†ï¼Œé‚£ä¹ˆæ— é™ä¸Šæ‹‰åŸºäºè¿™ç§æ–¹æ¡ˆè¦å¦‚ä½•è°ƒæ•´å®ç°å‘¢ï¼Ÿ
- å¦‚æœå°† Intersection Observer ç”¨åˆ° iScroll é‡Œé¢å»ï¼ŒåŸæœ‰æ–¹æ¡ˆå¯ä»¥æ€æ ·ä¼˜åŒ–ï¼Ÿ

#### ä»£ç å®ç°

- [å®Œæ•´ä»£ç å®ç°å‚è€ƒ](https://github.com/Guohjia/listScroll)

## å‚è€ƒæ–‡ç« 

- [Intersection Observer API](https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API)
- [IntersectionObserverâ€™s Coming into View](https://developers.google.com/web/updates/2016/04/intersectionobserver)
- [Infinite Scrollâ€™ing the right way](https://medium.com/walmartlabs/infinite-scrolling-the-right-way-11b098a08815)

> æœ¬æ–‡å‘å¸ƒè‡ª [ç½‘æ˜“äº‘éŸ³ä¹å‰ç«¯å›¢é˜Ÿ](https://github.com/x-orpheus)ï¼Œæ¬¢è¿è‡ªç”±è½¬è½½ï¼Œè½¬è½½è¯·ä¿ç•™å‡ºå¤„ã€‚æˆ‘ä»¬ä¸€ç›´åœ¨æ‹›äººï¼Œå¦‚æœä½ æ°å¥½å‡†å¤‡æ¢å·¥ä½œï¼Œåˆæ°å¥½å–œæ¬¢äº‘éŸ³ä¹ï¼Œé‚£å°± [åŠ å…¥æˆ‘ä»¬](mailto:grp.music-fe@corp.netease.com)

å…³æ³¨ä¸‹é¢çš„æ ‡ç­¾ï¼Œå‘ç°æ›´å¤šç›¸ä¼¼æ–‡ç« 

[JavaScript](https://juejin.im/tag/JavaScript)

[äº‘éŸ³ä¹å‰ç«¯æŠ€æœ¯å›¢é˜Ÿ](https://juejin.im/user/5cd23730f265da03576edbf1)[![lv-3](https://b-gold-cdn.xitu.io/v3/static/img/lv-3.e108c68.svg)](https://juejin.im/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022)ç½‘æ˜“äº‘éŸ³ä¹

[å‘å¸ƒäº† 13 ç¯‡ä¸“æ  Â· ](https://juejin.im/user/5cd23730f265da03576edbf1/posts)è·å¾—ç‚¹èµ 2,384 Â· è·å¾—é˜…è¯» 68,295

å®‰è£…æ˜é‡‘æµè§ˆå™¨æ’ä»¶

æ‰“å¼€æ–°æ ‡ç­¾é¡µå‘ç°å¥½å†…å®¹ï¼Œæ˜é‡‘ã€GitHubã€Dribbbleã€ProductHunt ç­‰ç«™ç‚¹å†…å®¹è½»æ¾è·å–ã€‚å¿«æ¥å®‰è£…æ˜é‡‘æµè§ˆå™¨æ’ä»¶è·å–é«˜è´¨é‡å†…å®¹å§ï¼

è¯„è®º

[å‰ç«¯å°ç„¶å­](https://juejin.im/user/59fac8c7f265da431d3c047c)[![lv-2](https://b-gold-cdn.xitu.io/v3/static/img/lv-2.f597b88.svg)](https://juejin.im/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022)

BUGæ•£å…»å¸ˆ @ @é˜¶çº§åˆ¶åº¦å…¬å¸é¢„å¤‡è·³æ§½

è¯´ä¸ªé¢˜å¤–è¯ï¼Œç½‘æ˜“äº‘çš„æ¨èç®—æ³•è¶Šæ¥è¶Šä¸è®¨å–œäº†  è°ƒæ•™ä¸å¥½  ç•Œé¢ã€ç”»é£æŒºå–œæ¬¢ï¼Œå°±æ˜¯æ¨èä¸äº†æˆ‘å–œæ¬¢çš„æ­Œ![ğŸ˜‚](https://gold-cdn.xitu.io/asset/twemoji/2.6.0/svg/1f602.svg)

19å°æ—¶å‰

å›å¤

[RandomYang](https://juejin.im/user/5a26acea51882531926e9502)[![lv-2](https://b-gold-cdn.xitu.io/v3/static/img/lv-2.f597b88.svg)](https://juejin.im/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022)

æ±‚å­¦è€… @ æœªçŸ¥

è²Œä¼¼å¾ˆæ—©ä¹‹å‰ï¼Œé¥¿äº†å—å†™è¿‡ä¸€ç¯‡å°†è¿™ä¸ªçš„ï¼Œæ€è·¯ç±»ä¼¼ã€‚

21å°æ—¶å‰

å›å¤

[æ€»æœ‰ä¸€å¤©æˆä¸ºæµ·è´¼ç‹çš„ç”·äºº](https://juejin.im/user/5d3ea7045188255d94344477)

æ­£åœ¨åŠªåŠ›çš„å‰ç«¯ğŸ¶

å¦‚æœæ¯ä¸€ä¸ªliçš„é«˜åº¦å›ºå®š å€’æ²¡ä»€ä¹ˆé—®é¢˜ ä½†æ˜¯é«˜åº¦ä¸å›ºå®šçš„æ—¶å€™ æ²¡æ³•å‡†ç¡®è®¡ç®—paddingçš„æŒ‡  æˆ‘è®¤ä¸ºè¿˜æ˜¯å¾—å¼‚æ­¥åŠ è½½æ•°æ®ç¡®å®šé«˜åº¦ã€‚ã€‚ ![ğŸ˜‚](https://gold-cdn.xitu.io/asset/twemoji/2.6.0/svg/1f602.svg)![ğŸ˜‚](https://gold-cdn.xitu.io/asset/twemoji/2.6.0/svg/1f602.svg) btw ä¸ªäººéå¸¸çƒ­çˆ±ç½‘æ˜“äº‘éŸ³ä¹ æœ‰æ¨¡ä»¿è¿‡iphoneç«¯çš„  åœ°å€æ˜¯ [![https://github.com/hemengke1997/vue-template](https://b-gold-cdn.xitu.io/v3/static/img/pin-url-link.3f843e8.svg)github.com/hemengke1997/v...](https://github.com/hemengke1997/vue-template)  å¦‚æœèƒ½æœ‰å¹¸åŠ å…¥è´µå…¬å¸å°±å¥½å•¦  ç½‘æ˜“äº‘upup![ğŸ˜œ](https://gold-cdn.xitu.io/asset/twemoji/2.6.0/svg/1f61c.svg)

1å¤©å‰

å›å¤

[è¿™æ³¢èƒ½åæ€](https://juejin.im/user/577a770ea633bd00573520f7)[![lv-3](https://b-gold-cdn.xitu.io/v3/static/img/lv-3.e108c68.svg)](https://juejin.im/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022)

å¤§å‰ç«¯å®è·µè€… @ å…¬ä¼—å·: ä¸çŸ¥éæ”»

æ–‡ç« å†™å¾—å¤ªæ£’äº†ï¼Œå¯ä»¥è½¬è½½åˆ°æˆ‘çš„å…¬ä¼—å·ï¼ˆä¸çŸ¥éæ”»ï¼‰å—

2å¤©å‰

å›å¤

[æ‰“çˆ†ä½ çš„ç‹—å¤´](https://juejin.im/user/5917f1f50ce4630069ee2120)

react-virtualizedè¿™ä¸ªåº“å¤§æ¦‚ä¹Ÿæ˜¯è¿™ä¸ªåŸç†

3å¤©å‰

å›å¤

[å—æ–¹ä»¥å—](https://juejin.im/user/5bada313f265da0ae5051de2)[![lv-2](https://b-gold-cdn.xitu.io/v3/static/img/lv-2.f597b88.svg)](https://juejin.im/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022)

å‰ç«¯

çº æ­£ä¸€ä¸‹æˆ‘çš„é”™è¯¯ï¼Œå¦‚æœæœ‰äººçœ‹åˆ°äº†æˆ‘çš„è¯„è®ºï¼Œéå¸¸æŠ±æ­‰ç»™å¤§å®¶é€ æˆäº†è¯¯å¯¼ã€‚ä¹‹å‰æˆ‘å¯¹è‡ªå·±çš„é—®é¢˜çš„æ€»ç»“å¾ˆç‰µå¼ºå¾ˆnaiveï¼Œé¦–å…ˆrequestIdleCallbackåªè¦æ³¨å†Œäº†ä¸å¯èƒ½ä¸æ‰§è¡Œï¼Œåªæ˜¯ä¼˜å…ˆçº§å¾ˆä½ï¼Œå½“æ—¶æˆ‘ä½¿ç”¨intersectionObserveræ—¶ï¼Œåˆ¤æ–­æ˜¯å¦ç›¸äº¤ä½¿ç”¨çš„entries[0].intersectionRatio > 0ï¼Œè¿™æ ·ç”¨çš„é—®é¢˜å°±æ˜¯ï¼šå½“ç›®æ ‡å…ƒç´ çš„é¡¶éƒ¨å’Œè§†å£çš„åº•éƒ¨åˆšå¥½ç›¸äº¤æ—¶ï¼Œå›è°ƒæ­£å¸¸è§¦å‘ï¼Œä½†æ˜¯entries[0].intersectionRatioçš„å€¼ä¸º0ï¼Œæ‰€ä»¥å°±å¯¼è‡´æˆ‘ä¹‹å‰å‡ºç°â€¦

å±•å¼€

4å¤©å‰

1

å›å¤

[äº‘éŸ³ä¹å‰ç«¯æŠ€æœ¯å›¢é˜Ÿ](https://juejin.im/user/5cd23730f265da03576edbf1)[![lv-3](https://b-gold-cdn.xitu.io/v3/static/img/lv-3.e108c68.svg)](https://juejin.im/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022)(ä½œè€…)

ç½‘æ˜“äº‘éŸ³ä¹

å›å¤ 

[å—æ–¹ä»¥å—](https://juejin.im/user/5bada313f265da0ae5051de2)[![lv-2](https://b-gold-cdn.xitu.io/v3/static/img/lv-2.f597b88.svg)](https://juejin.im/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022)

: 

æ˜é‡‘éœ€è¦ä½ è¿™æ ·è®¤çœŸçš„äºº ![ğŸ‘](https://gold-cdn.xitu.io/asset/twemoji/2.6.0/svg/1f44d.svg)

3å¤©å‰

å›å¤

[å—æ–¹ä»¥å—](https://juejin.im/user/5bada313f265da0ae5051de2)[![lv-2](https://b-gold-cdn.xitu.io/v3/static/img/lv-2.f597b88.svg)](https://juejin.im/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022)

å‰ç«¯

å›å¤ 

[äº‘éŸ³ä¹å‰ç«¯æŠ€æœ¯å›¢é˜Ÿ](https://juejin.im/user/5cd23730f265da03576edbf1)[![lv-3](https://b-gold-cdn.xitu.io/v3/static/img/lv-3.e108c68.svg)](https://juejin.im/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022)

(ä½œè€…)

: 

![ğŸ˜‚](https://gold-cdn.xitu.io/asset/twemoji/2.6.0/svg/1f602.svg)ä¸èƒ½æŠŠé”™è¯¯çš„çŸ¥è¯†ä¼ æ’­å‡ºå»ï¼Œæ— å¥ˆæœ‰æ—¶å€™æ°´å¹³æœ‰é™

3å¤©å‰

å›å¤